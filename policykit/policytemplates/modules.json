[
    {
        "name": "Enforce procedure time restrictions",
        "description": "Only start to check the status of a procedure after a given time",
        "codes": "if variables.duration > 0:\n  time_elapsed = proposal.get_time_elapsed()\n  if time_elapsed < datetime.timedelta(minutes=variables.duration):\n    return None\n\n",
        "variables":[
            {
                "name": "duration",
                "label": "Procedure duration (in minutes)",
                "entity": null,
                "default_value": "",
                "is_required": true,
                "prompt": "When the vote is closed (in minutes)",
                "type": "number",
                "is_list": false
            }
        ],
        "data": []
    },
    {
        "name": "Notify people who have not voted",
        "description": "Send an ephemeral message to people who have not voted yet according to the specified frequency (in minutes)",
        "codes": "# only if it involves a voting process\nif proposal.vote_post_id:\n\teligible_voters = proposal.data.get(\"eligible_voters\")\n\t# if the procedure defines its eligible voters; \n\t# we also assume we get all votes by the current GovernanceProcess\n\tif eligible_voters:\n\t\tif not proposal.data.get(\"last_time_notify_voters\"):\n\t\t\tproposal.data.set(\"last_time_notify_voters\", 0)\n\t\tif (proposal.get_time_elapsed().total_seconds() - proposal.data.get(\"last_time_notify_voters\")) > variables.notify_voter_frequency * 60:\n\t\t\tproposal.data.set(\"last_time_notify_voters\", proposal.get_time_elapsed().total_seconds())\n\t\t\tvoted_voters = [vote.username for vote in proposal.get_active_votes() or []]\n\t\t\tfor voter in eligible_voters:\n\t\t\t\tif voter not in voted_voters:\n\t\t\t\t\t# if the vote happens in a channel, then we should post an ephemeral message to each user\n\t\t\t\t\tlogger.debug(f\"{voter} have not voted yet\")\n\t\t\t\t\tif variables.vote_channel:\n\t\t\t\t\t\tslack.post_message(\"Please remember that you have not voted yet\", users=[voter], post_type='ephemeral', channel=variables.vote_channel)",
        "variables":[
            {
                "name": "notify_voter_frequency",
                "label": "Notification frequency (in minutes)",
                "entity": null,
                "default_value": "",
                "is_required": true,
                "prompt": "How often to notify people who have not voted yet (in minutes)",
                "type": "number",
                "is_list": false
            }
        ],
        "data": []
    }
]